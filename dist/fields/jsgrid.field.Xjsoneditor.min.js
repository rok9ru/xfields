/*! xfields */
!function(n,r){function t(t){n.Field.call(this,t)}t.prototype=new n.TextAreaField({templates:[],closeText:"Save",editText:"Editor",_doModal:function(t,e,o){return n.popup(t,e)},_createJsonEditor:function(t,e){"object"!=typeof(t=t||{})&&(t=JSON.parse(t));var o=r('<div id="jsoneditor" style="height: 500px;">'),e=(r("body").append(o),o=o[0],{templates:this.templates,modes:["code","text","tree"],onError:function(t){alert(t.toString())},mode:e||"view"});return new JSONEditor(o,e,t)},itemTemplate:function(e,t){var o=this;return r("<button>Редактор</button>").click(function(){var t=o._createJsonEditor(e);return o._doModal(t.container,{onClose:function(){r(t.container).remove(),t.destroy()}}),!1})},insertTemplate:function(){var t;return this.inserting?(t=this).insertControl=r("<textarea>").click(function(){var e=t._createJsonEditor({},"tree"),o=r(this);return t._doModal(e.container,{closeText:t.closeText,onClose:function(){var t=e.get();r.isEmptyObject(t)?o.val({}):o.val(JSON.stringify(t)),e.destroy()}}),!1}):""},editTemplate:function(t){var n;return this.editing?(n=this).editControl=r("<textarea>").val(t).click(function(){var e=r(this),o=n._createJsonEditor(e.val(),"tree");return n._doModal(o.container,{closeText:n.closeText,onClose:function(){var t=o.get();r.isEmptyObject(t)?e.val({}):e.val(JSON.stringify(t)),o.destroy()}}),!1}):this.itemTemplate.apply(this,arguments)}}),n.fields.Xjsoneditor=t}(jsGrid,jQuery);